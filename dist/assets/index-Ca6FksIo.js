var Vt=Object.defineProperty;var Wt=(e,t,n)=>t in e?Vt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var We=(e,t,n)=>Wt(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();function K(){}function Ut(e){return e()}function st(){return Object.create(null)}function oe(e){e.forEach(Ut)}function $e(e){return typeof e=="function"}function Ve(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}let Be;function at(e,t){return e===t?!0:(Be||(Be=document.createElement("a")),Be.href=t,e===Be.href)}function Kt(e){return Object.keys(e).length===0}function Pt(e,...t){if(e==null){for(const i of t)i(void 0);return K}const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function Ke(e,t,n){e.$$.on_destroy.push(Pt(t,n))}function y(e,t){e.appendChild(t)}function N(e,t,n){e.insertBefore(t,n||null)}function P(e){e.parentNode&&e.parentNode.removeChild(e)}function R(e){return document.createElement(e)}function F(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function re(e){return document.createTextNode(e)}function ie(){return re(" ")}function ee(){return re("")}function Y(e,t,n,i){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}function Ce(e){return function(t){return t.stopPropagation(),e.call(this,t)}}function a(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function Ot(e){return e===""?null:+e}function Ht(e){return Array.from(e.childNodes)}function Jt(e,t){t=""+t,e.data!==t&&(e.data=t)}function ye(e,t){e.value=t??""}function g(e,t,n,i){n==null?e.style.removeProperty(t):e.style.setProperty(t,n,"")}function Ft(e,t,{bubbles:n=!1,cancelable:i=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:i})}let Ie;function Ae(e){Ie=e}function et(){if(!Ie)throw new Error("Function called outside component initialization");return Ie}function zt(e){et().$$.on_mount.push(e)}function Zt(e){et().$$.on_destroy.push(e)}function Gt(){const e=et();return(t,n,{cancelable:i=!1}={})=>{const o=e.$$.callbacks[t];if(o){const r=Ft(t,n,{cancelable:i});return o.slice().forEach(l=>{l.call(e,r)}),!r.defaultPrevented}return!0}}const be=[],qe=[];let ke=[];const ft=[],Qt=Promise.resolve();let Qe=!1;function xt(){Qe||(Qe=!0,Qt.then(Nt))}function xe(e){ke.push(e)}const He=new Set;let ge=0;function Nt(){if(ge!==0)return;const e=Ie;do{try{for(;ge<be.length;){const t=be[ge];ge++,Ae(t),$t(t.$$)}}catch(t){throw be.length=0,ge=0,t}for(Ae(null),be.length=0,ge=0;qe.length;)qe.pop()();for(let t=0;t<ke.length;t+=1){const n=ke[t];He.has(n)||(He.add(n),n())}ke.length=0}while(be.length);for(;ft.length;)ft.pop()();Qe=!1,He.clear(),Ae(e)}function $t(e){if(e.fragment!==null){e.update(),oe(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(xe)}}function en(e){const t=[],n=[];ke.forEach(i=>e.indexOf(i)===-1?t.push(i):n.push(i)),n.forEach(i=>i()),ke=t}const je=new Set;let de;function Le(){de={r:0,c:[],p:de}}function Ue(){de.r||oe(de.c),de=de.p}function ne(e,t){e&&e.i&&(je.delete(e),e.i(t))}function se(e,t,n,i){if(e&&e.o){if(je.has(e))return;je.add(e),de.c.push(()=>{je.delete(e),i&&(n&&e.d(1),i())}),e.o(t)}else i&&i()}function ue(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function Tt(e,t){e.d(1),t.delete(e.key)}function Bt(e,t){se(e,1,1,()=>{t.delete(e.key)})}function Re(e,t,n,i,o,r,l,s,f,u,_,k){let m=e.length,w=r.length,c=m;const S={};for(;c--;)S[e[c].key]=c;const T=[],U=new Map,I=new Map,Z=[];for(c=w;c--;){const E=k(o,r,c),D=n(E);let A=l.get(D);A?Z.push(()=>A.p(E,t)):(A=u(D,E),A.c()),U.set(D,T[c]=A),D in S&&I.set(D,Math.abs(c-S[D]))}const q=new Set,H=new Set;function L(E){ne(E,1),E.m(s,_),l.set(E.key,E),_=E.first,w--}for(;m&&w;){const E=T[w-1],D=e[m-1],A=E.key,W=D.key;E===D?(_=E.first,m--,w--):U.has(W)?!l.has(A)||q.has(A)?L(E):H.has(W)?m--:I.get(A)>I.get(W)?(H.add(A),L(E)):(q.add(W),m--):(f(D,l),m--)}for(;m--;){const E=e[m];U.has(E.key)||f(E,l)}for(;w;)L(T[w-1]);return oe(Z),T}function jt(e){e&&e.c()}function tt(e,t,n){const{fragment:i,after_update:o}=e.$$;i&&i.m(t,n),xe(()=>{const r=e.$$.on_mount.map(Ut).filter($e);e.$$.on_destroy?e.$$.on_destroy.push(...r):oe(r),e.$$.on_mount=[]}),o.forEach(xe)}function nt(e,t){const n=e.$$;n.fragment!==null&&(en(n.after_update),oe(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function tn(e,t){e.$$.dirty[0]===-1&&(be.push(e),xt(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function it(e,t,n,i,o,r,l=null,s=[-1]){const f=Ie;Ae(e);const u=e.$$={fragment:null,ctx:[],props:r,update:K,not_equal:o,bound:st(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(f?f.$$.context:[])),callbacks:st(),dirty:s,skip_bound:!1,root:t.target||f.$$.root};l&&l(u.root);let _=!1;if(u.ctx=n?n(e,t.props||{},(k,m,...w)=>{const c=w.length?w[0]:m;return u.ctx&&o(u.ctx[k],u.ctx[k]=c)&&(!u.skip_bound&&u.bound[k]&&u.bound[k](c),_&&tn(e,k)),m}):[],u.update(),_=!0,oe(u.before_update),u.fragment=i?i(u.ctx):!1,t.target){if(t.hydrate){const k=Ht(t.target);u.fragment&&u.fragment.l(k),k.forEach(P)}else u.fragment&&u.fragment.c();t.intro&&ne(e.$$.fragment),tt(e,t.target,t.anchor),Nt()}Ae(f)}class ot{constructor(){We(this,"$$");We(this,"$$set")}$destroy(){nt(this,1),this.$destroy=K}$on(t,n){if(!$e(n))return K;const i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(n),()=>{const o=i.indexOf(n);o!==-1&&i.splice(o,1)}}$set(t){this.$$set&&!Kt(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const nn="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(nn);const me=[];function on(e,t){return{subscribe:he(e,t).subscribe}}function he(e,t=K){let n;const i=new Set;function o(s){if(Ve(e,s)&&(e=s,n)){const f=!me.length;for(const u of i)u[1](),me.push(u,e);if(f){for(let u=0;u<me.length;u+=2)me[u][0](me[u+1]);me.length=0}}}function r(s){o(s(e))}function l(s,f=K){const u=[s,f];return i.add(u),i.size===1&&(n=t(o,r)||K),s(e),()=>{i.delete(u),i.size===0&&n&&(n(),n=null)}}return{set:o,update:r,subscribe:l}}function ln(e,t,n){const i=!Array.isArray(e),o=i?[e]:e;if(!o.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const r=t.length<2;return on(n,(l,s)=>{let f=!1;const u=[];let _=0,k=K;const m=()=>{if(_)return;k();const c=t(i?u[0]:u,l,s);r?l(c):k=$e(c)?c:K},w=o.map((c,S)=>Pt(c,T=>{u[S]=T,_&=~(1<<S),f&&m()},()=>{_|=1<<S}));return f=!0,m(),function(){oe(w),k(),f=!1}})}const we=he("select"),Me=he([]),De=he(void 0),lt=he(0),rn=he(""),rt=he(Date.now());ln(De,e=>!!e);function sn(e,t){return{docId:e,image:void 0,layers:[{id:"layer-1",name:"Layer 1",visible:!0,zIndex:0,shapes:[]}],version:0,updatedAt:Date.now(),updatedBy:t.id}}function Je(e){Me.set(e.layers),De.set(e.image),lt.set(e.version),rt.set(e.updatedAt),rn.set(e.updatedBy)}function an(e,t){let n=[],i,o=0,r=Date.now();return Me.subscribe(l=>n=l)(),De.subscribe(l=>i=l)(),lt.subscribe(l=>o=l)(),rt.subscribe(l=>r=l)(),{docId:e,image:i,layers:n,version:o,updatedAt:r,updatedBy:t}}function Xe(e){Me.update(e),rt.set(Date.now())}function Fe(e,t){Xe(n=>n.map(i=>i.id===e?{...i,shapes:un(i.shapes,t)}:i))}function fn(e,t){console.log("deleteShape called with layerId:",e,"shapeId:",t),Xe(n=>n.map(i=>i.id===e?{...i,shapes:i.shapes.filter(o=>o.id!==t)}:i))}function un(e,t){const n=e.findIndex(o=>o.id===t.id);if(n===-1)return[...e,t];const i=e.slice();return i[n]=t,i}async function cn(e,t=2560,n=.82){const i=new Image;i.src=URL.createObjectURL(e),await new Promise((_,k)=>{i.onload=()=>_(),i.onerror=()=>k(new Error("Image load failed"))});const o=Math.min(1,t/Math.max(i.width,i.height)),r=Math.round(i.width*o),l=Math.round(i.height*o),s=Object.assign(document.createElement("canvas"),{width:r,height:l}),f=s.getContext("2d");if(!f)throw new Error("Canvas context not available");f.drawImage(i,0,0,r,l);const u=s.toDataURL("image/jpeg",n);return URL.revokeObjectURL(i.src),{dataUrl:u,width:r,height:l}}function dn(e){let t,n,i,o;return{c(){t=document.createElementNS("http://www.w3.org/1999/xhtml","div"),n=re(e[4]),g(t,"flex","1"),g(t,"white-space","pre-wrap"),g(t,"color",e[5]),g(t,"font-size",e[6]+"px"),g(t,"padding","6px"),g(t,"pointer-events","none")},m(r,l){N(r,t,l),y(t,n),i||(o=Y(t,"pointerdown",e[13]),i=!0)},p(r,l){l[0]&16&&Jt(n,r[4]),l[0]&32&&g(t,"color",r[5]),l[0]&64&&g(t,"font-size",r[6]+"px")},d(r){r&&P(t),i=!1,o()}}}function hn(e){let t,n,i;return{c(){t=document.createElementNS("http://www.w3.org/1999/xhtml","textarea"),g(t,"flex","1"),g(t,"resize","none"),g(t,"border","0"),g(t,"background","transparent"),g(t,"color",e[5]),g(t,"padding","6px"),g(t,"outline","none"),g(t,"font-size",e[6]+"px"),g(t,"pointer-events","auto")},m(o,r){N(o,t,r),e[15](t),ye(t,e[9]),n||(i=[Y(t,"input",e[16]),Y(t,"keydown",e[11]),Y(t,"blur",e[12])],n=!0)},p(o,r){r[0]&32&&g(t,"color",o[5]),r[0]&64&&g(t,"font-size",o[6]+"px"),r[0]&512&&ye(t,o[9])},d(o){o&&P(t),e[15](null),n=!1,oe(i)}}}function _n(e){let t,n,i,o,r,l,s,f,u,_;function k(c,S){return c[7]?hn:dn}let m=k(e),w=m(e);return{c(){t=F("g"),n=F("rect"),r=F("foreignObject"),l=document.createElementNS("http://www.w3.org/1999/xhtml","div"),w.c(),a(n,"x",e[0]),a(n,"y",e[1]),a(n,"width",i=e[2]||200),a(n,"height",o=e[3]||60),a(n,"fill","white"),a(n,"stroke",e[5]),a(n,"rx","6"),a(n,"ry","6"),g(n,"cursor",e[7]?"text":"move"),a(l,"xmlns","http://www.w3.org/1999/xhtml"),g(l,"width","100%"),g(l,"height","100%"),g(l,"display","flex"),g(l,"pointer-events",e[7]?"auto":"none"),a(r,"x",e[0]),a(r,"y",e[1]),a(r,"width",s=e[2]||200),a(r,"height",f=e[3]||60),g(r,"pointer-events",e[7]?"auto":"none"),a(t,"role","group"),a(t,"tabindex","0")},m(c,S){N(c,t,S),y(t,n),y(t,r),y(r,l),w.m(l,null),u||(_=[Y(n,"pointerdown",e[13]),Y(t,"keydown",e[17]),Y(t,"click",Ce(e[18])),Y(t,"dblclick",Ce(e[19]))],u=!0)},p(c,S){S[0]&1&&a(n,"x",c[0]),S[0]&2&&a(n,"y",c[1]),S[0]&4&&i!==(i=c[2]||200)&&a(n,"width",i),S[0]&8&&o!==(o=c[3]||60)&&a(n,"height",o),S[0]&32&&a(n,"stroke",c[5]),S[0]&128&&g(n,"cursor",c[7]?"text":"move"),m===(m=k(c))&&w?w.p(c,S):(w.d(1),w=m(c),w&&(w.c(),w.m(l,null))),S[0]&128&&g(l,"pointer-events",c[7]?"auto":"none"),S[0]&1&&a(r,"x",c[0]),S[0]&2&&a(r,"y",c[1]),S[0]&4&&s!==(s=c[2]||200)&&a(r,"width",s),S[0]&8&&f!==(f=c[3]||60)&&a(r,"height",f),S[0]&128&&g(r,"pointer-events",c[7]?"auto":"none")},i:K,o:K,d(c){c&&P(t),w.d(),u=!1,oe(_)}}}function pn(e,t,n){let{x:i=0}=t,{y:o=0}=t,{width:r=240}=t,{height:l=100}=t,{text:s=""}=t,{color:f="#ffffff"}=t,{fontSize:u=16}=t,{isEditing:_=!1}=t,{selected:k=!1}=t;const m=Gt();let w=null,c=s,S=!1,T=0,U=0,I=0,Z=0;zt(()=>{_&&w&&w.focus()});function q(p){(p.metaKey||p.ctrlKey)&&p.key==="Enter"&&m("save",{text:c.trim()})}function H(){m("save",{text:c.trim()})}function L(p){if(console.log("Textbox onDragStart called, isEditing:",_,"selected:",k),_)return;m("select"),p.stopPropagation(),S=!0,T=p.clientX,U=p.clientY,I=i,Z=o;const X=p.target.closest("svg");X&&(X.addEventListener("pointermove",E),X.addEventListener("pointerup",D),X.setPointerCapture(p.pointerId))}function E(p){if(!S)return;const X=p.clientX-T,C=p.clientY-U;if(Math.abs(X)>2||Math.abs(C)>2){const h=Math.max(0,I+X),b=Math.max(0,Z+C);m("move",{x:h,y:b})}}function D(p){if(!S)return;const X=p.clientX-T,C=p.clientY-U,h=Math.sqrt(X*X+C*C);S=!1,h<5&&(console.log("Textbox: Treating as click/select (movement:",h,")"),m("select"));const b=p.target.closest("svg");b&&(b.removeEventListener("pointermove",E),b.removeEventListener("pointerup",D),b.releasePointerCapture(p.pointerId))}function A(p){qe[p?"unshift":"push"](()=>{w=p,n(8,w)})}function W(){c=this.value,n(9,c),n(7,_),n(4,s)}const V=p=>{(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),m("select"))},B=()=>m("select"),j=()=>m("startEdit");return e.$$set=p=>{"x"in p&&n(0,i=p.x),"y"in p&&n(1,o=p.y),"width"in p&&n(2,r=p.width),"height"in p&&n(3,l=p.height),"text"in p&&n(4,s=p.text),"color"in p&&n(5,f=p.color),"fontSize"in p&&n(6,u=p.fontSize),"isEditing"in p&&n(7,_=p.isEditing),"selected"in p&&n(14,k=p.selected)},e.$$.update=()=>{e.$$.dirty[0]&144&&_&&n(9,c=s)},[i,o,r,l,s,f,u,_,w,c,m,q,H,L,k,A,W,V,B,j]}class gn extends ot{constructor(t){super(),it(this,t,pn,_n,Ve,{x:0,y:1,width:2,height:3,text:4,color:5,fontSize:6,isEditing:7,selected:14},null,[-1,-1])}}function ut(e,t,n){const i=e.slice();return i[54]=t[n],i}function ct(e,t,n){const i=e.slice();return i[57]=t[n],i}function dt(e,t,n){const i=e.slice();return i[54]=t[n],i}function ht(e,t,n){const i=e.slice();return i[57]=t[n],i}function _t(e){let t;return{c(){t=R("div"),t.textContent="Read-only: in use by another editor",a(t,"class","busy-banner svelte-1n3uqbm")},m(n,i){N(n,t,i)},d(n){n&&P(t)}}}function mn(e){let t;return{c(){t=R("div"),t.textContent="No image loaded yet. Use the file picker above.",g(t,"padding","24px")},m(n,i){N(n,t,i)},p:K,i:K,o:K,d(n){n&&P(t)}}}function wn(e){let t,n,i,o,r,l,s,f,u=[],_=new Map,k,m,w,c,S,T,U,I=[],Z=new Map,q,H,L,E,D,A=e[8]&&pt(e),W=ue(e[1]);const V=h=>h[54].id;for(let h=0;h<W.length;h+=1){let b=dt(e,W,h),O=V(b);_.set(O,u[h]=wt(O,b))}let B=e[13]==="draw"&&e[5].length>0&&bt(e),j=e[13]==="arrow"&&e[6]&&e[7]&&yt(e),p=e[13]==="text"&&e[8]&&kt(e),X=ue(e[1]);const C=h=>h[54].id;for(let h=0;h<X.length;h+=1){let b=ut(e,X,h),O=C(b);Z.set(O,I[h]=At(O,b))}return{c(){t=R("div"),n=R("img"),l=ie(),s=F("svg"),A&&A.c(),f=ee();for(let h=0;h<u.length;h+=1)u[h].c();k=ee(),B&&B.c(),m=ee(),j&&j.c(),w=ee(),p&&p.c(),T=ie(),U=F("svg");for(let h=0;h<I.length;h+=1)I[h].c();at(n.src,i=e[0].dataUrl)||a(n,"src",i),a(n,"width",o=e[0].width),a(n,"height",r=e[0].height),a(n,"alt","Markup base"),g(n,"display","block"),g(n,"max-width","100%"),g(n,"height","auto"),a(s,"width",c=e[0].width),a(s,"height",S=e[0].height),g(s,"position","absolute"),g(s,"inset","0"),a(U,"width",q=e[0].width),a(U,"height",H=e[0].height),g(U,"position","absolute"),g(U,"inset","0"),g(U,"pointer-events","none"),g(t,"display","inline-block"),g(t,"position","relative")},m(h,b){N(h,t,b),y(t,n),e[29](n),y(t,l),y(t,s),A&&A.m(s,null),y(s,f);for(let O=0;O<u.length;O+=1)u[O]&&u[O].m(s,null);y(s,k),B&&B.m(s,null),y(s,m),j&&j.m(s,null),y(s,w),p&&p.m(s,null),y(t,T),y(t,U);for(let O=0;O<I.length;O+=1)I[O]&&I[O].m(U,null);L=!0,E||(D=[Y(s,"pointerdown",e[15]),Y(s,"pointermove",e[16]),Y(s,"pointerup",e[17])],E=!0)},p(h,b){(!L||b[0]&1&&!at(n.src,i=h[0].dataUrl))&&a(n,"src",i),(!L||b[0]&1&&o!==(o=h[0].width))&&a(n,"width",o),(!L||b[0]&1&&r!==(r=h[0].height))&&a(n,"height",r),h[8]?A?A.p(h,b):(A=pt(h),A.c(),A.m(s,f)):A&&(A.d(1),A=null),b[0]&11786&&(W=ue(h[1]),Le(),u=Re(u,b,V,1,h,W,_,s,Bt,wt,k,dt),Ue()),h[13]==="draw"&&h[5].length>0?B?B.p(h,b):(B=bt(h),B.c(),B.m(s,m)):B&&(B.d(1),B=null),h[13]==="arrow"&&h[6]&&h[7]?j?j.p(h,b):(j=yt(h),j.c(),j.m(s,w)):j&&(j.d(1),j=null),h[13]==="text"&&h[8]?p?p.p(h,b):(p=kt(h),p.c(),p.m(s,null)):p&&(p.d(1),p=null),(!L||b[0]&1&&c!==(c=h[0].width))&&a(s,"width",c),(!L||b[0]&1&&S!==(S=h[0].height))&&a(s,"height",S),b[0]&2050&&(X=ue(h[1]),I=Re(I,b,C,1,h,X,Z,U,Tt,At,null,ut)),(!L||b[0]&1&&q!==(q=h[0].width))&&a(U,"width",q),(!L||b[0]&1&&H!==(H=h[0].height))&&a(U,"height",H)},i(h){if(!L){for(let b=0;b<W.length;b+=1)ne(u[b]);L=!0}},o(h){for(let b=0;b<u.length;b+=1)se(u[b]);L=!1},d(h){h&&P(t),e[29](null),A&&A.d();for(let b=0;b<u.length;b+=1)u[b].d();B&&B.d(),j&&j.d(),p&&p.d();for(let b=0;b<I.length;b+=1)I[b].d();E=!1,oe(D)}}}function pt(e){let t,n,i,o,r;return{c(){t=F("rect"),a(t,"x",n=e[8].x),a(t,"y",i=e[8].y),a(t,"width",o=e[8].w),a(t,"height",r=e[8].h),a(t,"fill","none"),a(t,"stroke",e[3]),a(t,"stroke-dasharray","4 4")},m(l,s){N(l,t,s)},p(l,s){s[0]&256&&n!==(n=l[8].x)&&a(t,"x",n),s[0]&256&&i!==(i=l[8].y)&&a(t,"y",i),s[0]&256&&o!==(o=l[8].w)&&a(t,"width",o),s[0]&256&&r!==(r=l[8].h)&&a(t,"height",r),s[0]&8&&a(t,"stroke",l[3])},d(l){l&&P(t)}}}function gt(e){let t=[],n=new Map,i,o,r=ue(e[54].shapes);const l=s=>s[57].id;for(let s=0;s<r.length;s+=1){let f=ht(e,r,s),u=l(f);n.set(u,t[s]=mt(u,f))}return{c(){for(let s=0;s<t.length;s+=1)t[s].c();i=ee()},m(s,f){for(let u=0;u<t.length;u+=1)t[u]&&t[u].m(s,f);N(s,i,f),o=!0},p(s,f){f[0]&11786&&(r=ue(s[54].shapes),Le(),t=Re(t,f,l,1,s,r,n,i.parentNode,Bt,mt,i,ht),Ue())},i(s){if(!o){for(let f=0;f<r.length;f+=1)ne(t[f]);o=!0}},o(s){for(let f=0;f<t.length;f+=1)se(t[f]);o=!1},d(s){s&&P(i);for(let f=0;f<t.length;f+=1)t[f].d(s)}}}function bn(e){let t,n;function i(){return e[30](e[57])}function o(...f){return e[31](e[57],...f)}function r(...f){return e[32](e[57],...f)}function l(...f){return e[33](e[57],...f)}function s(){return e[34](e[57])}return t=new gn({props:{x:e[57].position.x,y:e[57].position.y,width:e[57].width||200,height:e[57].height||60,text:e[57].text,color:e[57].fill||e[3],fontSize:e[57].fontSize||16,isEditing:e[9]===e[57].id,selected:e[11]===e[57].id}}),t.$on("select",i),t.$on("save",o),t.$on("resize",r),t.$on("move",l),t.$on("startEdit",s),{c(){jt(t.$$.fragment)},m(f,u){tt(t,f,u),n=!0},p(f,u){e=f;const _={};u[0]&2&&(_.x=e[57].position.x),u[0]&2&&(_.y=e[57].position.y),u[0]&2&&(_.width=e[57].width||200),u[0]&2&&(_.height=e[57].height||60),u[0]&2&&(_.text=e[57].text),u[0]&10&&(_.color=e[57].fill||e[3]),u[0]&2&&(_.fontSize=e[57].fontSize||16),u[0]&514&&(_.isEditing=e[9]===e[57].id),u[0]&2050&&(_.selected=e[11]===e[57].id),t.$set(_)},i(f){n||(ne(t.$$.fragment,f),n=!0)},o(f){se(t.$$.fragment,f),n=!1},d(f){nt(t,f)}}}function yn(e){let t,n,i,o,r,l,s;return{c(){t=F("line"),a(t,"x1",n=e[57].points[0].x),a(t,"y1",i=e[57].points[0].y),a(t,"x2",o=e[57].points[1].x),a(t,"y2",r=e[57].points[1].y),a(t,"stroke",l=e[57].stroke||"#2f6feb"),a(t,"stroke-width",s=e[57].strokeWidth||3)},m(f,u){N(f,t,u)},p(f,u){u[0]&2&&n!==(n=f[57].points[0].x)&&a(t,"x1",n),u[0]&2&&i!==(i=f[57].points[0].y)&&a(t,"y1",i),u[0]&2&&o!==(o=f[57].points[1].x)&&a(t,"x2",o),u[0]&2&&r!==(r=f[57].points[1].y)&&a(t,"y2",r),u[0]&2&&l!==(l=f[57].stroke||"#2f6feb")&&a(t,"stroke",l),u[0]&2&&s!==(s=f[57].strokeWidth||3)&&a(t,"stroke-width",s)},i:K,o:K,d(f){f&&P(t)}}}function kn(e){let t,n,i,o;return{c(){t=F("path"),a(t,"d",n=Ye(e[57].points)),a(t,"fill","none"),a(t,"stroke",i=e[57].stroke||"#2f6feb"),a(t,"stroke-width",o=e[57].strokeWidth||3),a(t,"stroke-linecap","round"),a(t,"stroke-linejoin","round")},m(r,l){N(r,t,l)},p(r,l){l[0]&2&&n!==(n=Ye(r[57].points))&&a(t,"d",n),l[0]&2&&i!==(i=r[57].stroke||"#2f6feb")&&a(t,"stroke",i),l[0]&2&&o!==(o=r[57].strokeWidth||3)&&a(t,"stroke-width",o)},i:K,o:K,d(r){r&&P(t)}}}function mt(e,t){let n,i,o,r,l;const s=[kn,yn,bn],f=[];function u(_,k){return _[57].kind==="freehand"?0:_[57].kind==="arrow"?1:_[57].kind==="text"?2:-1}return~(i=u(t))&&(o=f[i]=s[i](t)),{key:e,first:null,c(){n=ee(),o&&o.c(),r=ee(),this.first=n},m(_,k){N(_,n,k),~i&&f[i].m(_,k),N(_,r,k),l=!0},p(_,k){t=_;let m=i;i=u(t),i===m?~i&&f[i].p(t,k):(o&&(Le(),se(f[m],1,1,()=>{f[m]=null}),Ue()),~i?(o=f[i],o?o.p(t,k):(o=f[i]=s[i](t),o.c()),ne(o,1),o.m(r.parentNode,r)):o=null)},i(_){l||(ne(o),l=!0)},o(_){se(o),l=!1},d(_){_&&(P(n),P(r)),~i&&f[i].d(_)}}}function wt(e,t){let n,i,o,r=t[54].visible&&gt(t);return{key:e,first:null,c(){n=ee(),r&&r.c(),i=ee(),this.first=n},m(l,s){N(l,n,s),r&&r.m(l,s),N(l,i,s),o=!0},p(l,s){t=l,t[54].visible?r?(r.p(t,s),s[0]&2&&ne(r,1)):(r=gt(t),r.c(),ne(r,1),r.m(i.parentNode,i)):r&&(Le(),se(r,1,1,()=>{r=null}),Ue())},i(l){o||(ne(r),o=!0)},o(l){se(r),o=!1},d(l){l&&(P(n),P(i)),r&&r.d(l)}}}function bt(e){let t,n;return{c(){t=F("path"),a(t,"d",n=Ye(e[5])),a(t,"fill","none"),a(t,"stroke",e[3]),a(t,"stroke-width",e[4]),a(t,"stroke-linecap","round"),a(t,"stroke-linejoin","round")},m(i,o){N(i,t,o)},p(i,o){o[0]&32&&n!==(n=Ye(i[5]))&&a(t,"d",n),o[0]&8&&a(t,"stroke",i[3]),o[0]&16&&a(t,"stroke-width",i[4])},d(i){i&&P(t)}}}function yt(e){let t,n,i,o,r;return{c(){t=F("line"),a(t,"x1",n=e[6].x),a(t,"y1",i=e[6].y),a(t,"x2",o=e[7].x),a(t,"y2",r=e[7].y),a(t,"stroke",e[3]),a(t,"stroke-width",e[4])},m(l,s){N(l,t,s)},p(l,s){s[0]&64&&n!==(n=l[6].x)&&a(t,"x1",n),s[0]&64&&i!==(i=l[6].y)&&a(t,"y1",i),s[0]&128&&o!==(o=l[7].x)&&a(t,"x2",o),s[0]&128&&r!==(r=l[7].y)&&a(t,"y2",r),s[0]&8&&a(t,"stroke",l[3]),s[0]&16&&a(t,"stroke-width",l[4])},d(l){l&&P(t)}}}function kt(e){let t,n,i,o,r;return{c(){t=F("rect"),a(t,"x",n=e[8].x),a(t,"y",i=e[8].y),a(t,"width",o=e[8].w),a(t,"height",r=e[8].h),a(t,"fill","none"),a(t,"stroke",e[3]),a(t,"stroke-dasharray","4 4")},m(l,s){N(l,t,s)},p(l,s){s[0]&256&&n!==(n=l[8].x)&&a(t,"x",n),s[0]&256&&i!==(i=l[8].y)&&a(t,"y",i),s[0]&256&&o!==(o=l[8].w)&&a(t,"width",o),s[0]&256&&r!==(r=l[8].h)&&a(t,"height",r),s[0]&8&&a(t,"stroke",l[3])},d(l){l&&P(t)}}}function vt(e){let t=[],n=new Map,i,o=ue(e[54].shapes);const r=l=>l[57].id;for(let l=0;l<o.length;l+=1){let s=ct(e,o,l),f=r(s);n.set(f,t[l]=Et(f,s))}return{c(){for(let l=0;l<t.length;l+=1)t[l].c();i=ee()},m(l,s){for(let f=0;f<t.length;f+=1)t[f]&&t[f].m(l,s);N(l,i,s)},p(l,s){s[0]&2050&&(o=ue(l[54].shapes),t=Re(t,s,r,1,l,o,n,i.parentNode,Tt,Et,i,ct))},d(l){l&&P(i);for(let s=0;s<t.length;s+=1)t[s].d(l)}}}function St(e){let t,n,i,o,r,l,s,f,u,_,k;function m(){return e[35](e[57])}return{c(){t=F("g"),n=F("rect"),i=F("text"),o=re(`Ã—
                    `),l=F("g"),s=F("rect"),f=F("path"),a(n,"x","0"),a(n,"y","0"),a(n,"width","20"),a(n,"height","20"),a(n,"rx","3"),a(n,"ry","3"),a(n,"fill","#d9534f"),a(n,"stroke","#a94442"),a(n,"stroke-width","2"),a(i,"x","10"),a(i,"y","14"),a(i,"text-anchor","middle"),a(i,"fill","#fff"),a(i,"font-size","14"),a(i,"font-family","sans-serif"),g(i,"user-select","none"),g(i,"pointer-events","none"),a(t,"transform",r=`translate(${e[57].position.x+(e[57].width||200)-20}, ${e[57].position.y-10})`),g(t,"cursor","pointer"),g(t,"pointer-events","auto"),a(s,"x",-6),a(s,"y",-6),a(s,"width",12),a(s,"height",12),a(s,"rx","2"),a(s,"ry","2"),a(s,"fill","#2f6feb"),a(s,"stroke","#1f4ed4"),g(s,"cursor","se-resize"),a(f,"d","M -2,-2 L 2,2 M 0,-2 L 2,0 M -2,0 L 0,2"),a(f,"stroke","white"),a(f,"stroke-width","1"),g(f,"pointer-events","none"),a(l,"transform",u=`translate(${e[57].position.x+(e[57].width||200)-8}, ${e[57].position.y+(e[57].height||60)-8})`),g(l,"pointer-events","auto")},m(w,c){N(w,t,c),y(t,n),y(t,i),y(i,o),N(w,l,c),y(l,s),y(l,f),_||(k=[Y(t,"mousedown",Ce(m)),Y(s,"pointerdown",Ce(e[36]))],_=!0)},p(w,c){e=w,c[0]&2&&r!==(r=`translate(${e[57].position.x+(e[57].width||200)-20}, ${e[57].position.y-10})`)&&a(t,"transform",r),c[0]&2&&u!==(u=`translate(${e[57].position.x+(e[57].width||200)-8}, ${e[57].position.y+(e[57].height||60)-8})`)&&a(l,"transform",u)},d(w){w&&(P(t),P(l)),_=!1,oe(k)}}}function Et(e,t){let n,i,o=t[57].kind==="text"&&t[11]===t[57].id&&St(t);return{key:e,first:null,c(){n=ee(),o&&o.c(),i=ee(),this.first=n},m(r,l){N(r,n,l),o&&o.m(r,l),N(r,i,l)},p(r,l){t=r,t[57].kind==="text"&&t[11]===t[57].id?o?o.p(t,l):(o=St(t),o.c(),o.m(i.parentNode,i)):o&&(o.d(1),o=null)},d(r){r&&(P(n),P(i)),o&&o.d(r)}}}function At(e,t){let n,i,o=t[54].visible&&vt(t);return{key:e,first:null,c(){n=ee(),o&&o.c(),i=ee(),this.first=n},m(r,l){N(r,n,l),o&&o.m(r,l),N(r,i,l)},p(r,l){t=r,t[54].visible?o?o.p(t,l):(o=vt(t),o.c(),o.m(i.parentNode,i)):o&&(o.d(1),o=null)},d(r){r&&(P(n),P(i)),o&&o.d(r)}}}function vn(e){let t,n,i,o,r,l,s,f,u,_,k,m,w,c,S,T,U,I,Z,q,H,L,E,D,A,W,V,B,j,p,X,C,h,b,O,ce,_e,le,ve,x,te,$,Se,Pe,G=!e[12]&&_t();const Oe=[wn,mn],ae=[];function ze(z,J){return z[0]?0:1}return x=ze(e),te=ae[x]=Oe[x](e),{c(){t=R("div"),n=R("div"),i=R("div"),o=R("button"),r=re("Select"),s=ie(),f=R("button"),u=re("Arrow"),k=ie(),m=R("button"),w=re("Draw"),S=ie(),T=R("button"),U=re("Text"),Z=ie(),q=R("button"),H=re("Eraser"),E=ie(),D=R("div"),A=R("label"),W=re("Color "),V=R("input"),j=ie(),p=R("label"),X=re("Width "),C=R("input"),b=ie(),O=R("input"),_e=ie(),le=R("div"),G&&G.c(),ve=ie(),te.c(),o.disabled=l=!e[12],f.disabled=_=!e[12],m.disabled=c=!e[12],T.disabled=I=!e[12],q.disabled=L=!e[12],a(V,"type","color"),V.disabled=B=!e[12],a(C,"type","number"),a(C,"min","1"),a(C,"max","12"),C.disabled=h=!e[12],g(C,"width","60px"),g(D,"display","flex"),g(D,"gap","10px"),g(D,"align-items","center"),g(D,"padding-left","16px"),a(O,"class","image-input svelte-1n3uqbm"),a(O,"type","file"),a(O,"accept","image/*"),O.disabled=ce=!e[12],a(n,"class","toolbar svelte-1n3uqbm"),a(le,"class","stage-wrap svelte-1n3uqbm"),a(t,"class","board-root svelte-1n3uqbm")},m(z,J){N(z,t,J),y(t,n),y(n,i),y(i,o),y(o,r),y(i,s),y(i,f),y(f,u),y(i,k),y(i,m),y(m,w),y(i,S),y(i,T),y(T,U),y(i,Z),y(i,q),y(q,H),y(n,E),y(n,D),y(D,A),y(A,W),y(A,V),ye(V,e[3]),y(D,j),y(D,p),y(p,X),y(p,C),ye(C,e[4]),y(n,b),y(n,O),y(t,_e),y(t,le),G&&G.m(le,null),y(le,ve),ae[x].m(le,null),$=!0,Se||(Pe=[Y(o,"click",e[22]),Y(f,"click",e[23]),Y(m,"click",e[24]),Y(T,"click",e[25]),Y(q,"click",e[26]),Y(V,"input",e[27]),Y(C,"input",e[28]),Y(O,"change",e[14])],Se=!0)},p(z,J){(!$||J[0]&4096&&l!==(l=!z[12]))&&(o.disabled=l),(!$||J[0]&4096&&_!==(_=!z[12]))&&(f.disabled=_),(!$||J[0]&4096&&c!==(c=!z[12]))&&(m.disabled=c),(!$||J[0]&4096&&I!==(I=!z[12]))&&(T.disabled=I),(!$||J[0]&4096&&L!==(L=!z[12]))&&(q.disabled=L),(!$||J[0]&4096&&B!==(B=!z[12]))&&(V.disabled=B),J[0]&8&&ye(V,z[3]),(!$||J[0]&4096&&h!==(h=!z[12]))&&(C.disabled=h),J[0]&16&&Ot(C.value)!==z[4]&&ye(C,z[4]),(!$||J[0]&4096&&ce!==(ce=!z[12]))&&(O.disabled=ce),z[12]?G&&(G.d(1),G=null):G||(G=_t(),G.c(),G.m(le,ve));let Ee=x;x=ze(z),x===Ee?ae[x].p(z,J):(Le(),se(ae[Ee],1,1,()=>{ae[Ee]=null}),Ue(),te=ae[x],te?te.p(z,J):(te=ae[x]=Oe[x](z),te.c()),ne(te,1),te.m(le,null))},i(z){$||(ne(te),$=!0)},o(z){se(te),$=!1},d(z){z&&P(t),G&&G.d(),ae[x].d(),Se=!1,oe(Pe)}}}const Sn=15e3,En=12e3,An=1200,It=20;function Ze(e){return`${e}_${Date.now()}_${Math.random().toString(36).slice(2,8)}`}function Ye(e){if(e.length===0)return"";const[t,...n]=e;return`M ${t.x} ${t.y} `+n.map(i=>`L ${i.x} ${i.y}`).join(" ")}function Ge(e){const t=e.currentTarget.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}}function Mt(e,t,n){const i=n.x-t.x,o=n.y-t.y,r=e.x-t.x,l=e.y-t.y,s=i*r+o*l;if(s<=0)return Math.hypot(e.x-t.x,e.y-t.y);const f=i*i+o*o;if(f<=s)return Math.hypot(e.x-n.x,e.y-n.y);const u=s/f,_={x:t.x+u*i,y:t.y+u*o};return Math.hypot(e.x-_.x,e.y-_.y)}function In(e,t,n=8){if(e.kind==="freehand"){const i=e.points;for(let o=1;o<i.length;o++)if(Mt(t,i[o-1],i[o])<=(e.strokeWidth||3)+n)return!0;return!1}if(e.kind==="arrow"){const[i,o]=e.points;return Mt(t,i,o)<=(e.strokeWidth||3)+n}if(e.kind==="text"){const i=t.x-e.position.x,o=t.y-e.position.y;return Math.hypot(i,o)<=10+n}return!1}function Mn(e,t,n){let i,o,r;Ke(e,we,d=>n(13,i=d)),Ke(e,De,d=>n(0,o=d)),Ke(e,Me,d=>n(1,r=d));let{docId:l}=t,{currentUser:s}=t,{storageAdapter:f}=t,{lockAdapter:u}=t,_=null,k="#2f6feb",m=3,w=null,c=[],S=null,T=null,U=!1,I=null,Z=null,q=null,H="",L=null,E=!1,D,A,W=!1,V,B;function j(){E&&(clearTimeout(B),B=setTimeout(b,An))}async function p(){var d;try{const v=await f.getDocument(l).catch(()=>sn(l,s));Je(v),V=(d=v.image)==null?void 0:d.dataUrl,await X()}catch(v){console.error(v)}}async function X(){try{(await u.acquire(l,s.id)).ok?(n(12,E=!0),C()):(n(12,E=!1),h())}catch(d){console.error(d),n(12,E=!1),h()}}function C(){clearInterval(A),clearInterval(D),D=setInterval(async()=>{try{(await u.renew(l,s.id)).ok||(n(12,E=!1),clearInterval(D),h())}catch(d){console.warn("renew failed",d)}},Sn)}function h(){clearInterval(D),clearInterval(A),A=setInterval(async()=>{var d;try{if(!(await u.get(l)).locked)clearInterval(A),await X();else{const M=await f.getDocument(l);Je(M),V=(d=M.image)==null?void 0:d.dataUrl}}catch{}},En)}async function b(){var d,v;if(!(!E||W)){W=!0;try{const M=an(l,s.id);((d=M.image)==null?void 0:d.dataUrl)===V&&(M.image=void 0);const{version:Q}=await f.saveDocument(l,M,M.version);lt.set(Q),M.image&&M.image.dataUrl&&(V=M.image.dataUrl)}catch(M){if(M.message==="version_conflict"){const Q=await f.getDocument(l);Je(Q),V=(v=Q.image)==null?void 0:v.dataUrl,n(12,E=!1),h()}else console.error(M)}finally{W=!1}}}async function O(d){var Te;const M=(Te=d.target.files)==null?void 0:Te[0];if(!M)return;const{dataUrl:Q,width:fe,height:pe}=await cn(M),Ne=Date.now();De.set({dataUrl:Q,width:fe,height:pe,updatedAt:Ne,updatedBy:s.id}),V=void 0,j()}function ce(){let d=[];Me.subscribe(M=>d=M)();const v=d.find(M=>M.visible)||d[0];return(v==null?void 0:v.id)??null}function _e(d){Xe(v=>v.map(M=>M.id===d.layerId?{...M,shapes:[...M.shapes,d]}:M))}function le(d){const v=ce();v&&Xe(M=>M.map(Q=>Q.id===v?{...Q,shapes:Q.shapes.filter(fe=>!In(fe,d))}:Q))}function ve(d){if(console.log("MarkupBoard intercepted pointer event from:",d.target,"Current tool:",i),!E||(i==="select"&&d.target===d.currentTarget&&n(11,L=null),w=ce(),!w))return;U=!0;const v=Ge(d);if(n(7,T=v),i==="draw")n(5,c=[v]);else if(i==="arrow")n(6,S=v);else if(i==="text"){if(q){U=!1;return}I=v,n(8,Z={x:v.x,y:v.y,w:0,h:0})}else i==="erase"&&le(v)}function x(d){if(!E||!U)return;const v=Ge(d);if(n(7,T=v),i==="draw")n(5,c=[...c,v]);else if(i==="text"&&I){const M=Math.min(I.x,v.x),Q=Math.min(I.y,v.y),fe=Math.abs(v.x-I.x),pe=Math.abs(v.y-I.y);n(8,Z={x:M,y:Q,w:fe,h:pe})}else i==="erase"&&le(v)}function te(d){if(!E)return;const v=Ge(d);if(i==="draw"&&c.length>1&&w){const M={id:Ze("fh"),kind:"freehand",layerId:w,createdAt:Date.now(),createdBy:s.id,updatedAt:Date.now(),points:c,stroke:k,strokeWidth:m};_e(M)}else if(i==="arrow"&&S&&w){const M={id:Ze("arr"),kind:"arrow",layerId:w,createdAt:Date.now(),createdBy:s.id,updatedAt:Date.now(),points:[S,v],stroke:k,strokeWidth:m,arrowHead:"triangle"};_e(M)}else if(i==="text"&&I&&w){const M=Math.min(I.x,v.x),Q=Math.min(I.y,v.y),fe=Math.abs(v.x-I.x),pe=Math.abs(v.y-I.y);if(fe>=It&&pe>=It){const Ne=Ze("txt"),Te={id:Ne,kind:"text",layerId:w,createdAt:Date.now(),createdBy:s.id,updatedAt:Date.now(),position:{x:M,y:Q},text:"",fontSize:16,fill:k,width:fe,height:pe};_e(Te),n(9,q=Ne),n(10,H="")}}n(5,c=[]),n(6,S=null),n(7,T=null),U=!1,I=null,n(8,Z=null)}zt(()=>{p()}),Zt(async()=>{if(clearInterval(D),clearInterval(A),E)try{await u.release(l,s.id)}catch{}});const $=()=>we.set("select"),Se=()=>we.set("arrow"),Pe=()=>we.set("draw"),G=()=>we.set("text"),Oe=()=>we.set("erase");function ae(){k=this.value,n(3,k)}function ze(){m=Ot(this.value),n(4,m)}function z(d){qe[d?"unshift":"push"](()=>{_=d,n(2,_)})}const J=d=>{i==="select"&&(console.log("Selecting text box:",d.id,"Previous selected:",L),n(11,L=d.id))},Ee=(d,v)=>{Fe(d.layerId,{...d,text:v.detail.text,updatedAt:Date.now()}),n(9,q=null),n(10,H="")},Ct=(d,v)=>{Fe(d.layerId,{...d,width:v.detail.width,height:v.detail.height,updatedAt:Date.now()})},qt=(d,v)=>{Fe(d.layerId,{...d,position:{x:v.detail.x,y:v.detail.y},updatedAt:Date.now()})},Rt=d=>{n(9,q=d.id),n(10,H=d.text)},Xt=d=>{console.log("UI Layer: Delete button clicked!"),fn(d.layerId,d.id),n(11,L=null)},Yt=d=>{console.log("UI Layer: Resize handle clicked")};return e.$$set=d=>{"docId"in d&&n(18,l=d.docId),"currentUser"in d&&n(19,s=d.currentUser),"storageAdapter"in d&&n(20,f=d.storageAdapter),"lockAdapter"in d&&n(21,u=d.lockAdapter)},e.$$.update=()=>{e.$$.dirty[0]&2&&j(),e.$$.dirty[0]&1&&j()},[o,r,_,k,m,c,S,T,Z,q,H,L,E,i,O,ve,x,te,l,s,f,u,$,Se,Pe,G,Oe,ae,ze,z,J,Ee,Ct,qt,Rt,Xt,Yt]}class Dn extends ot{constructor(t){super(),it(this,t,Mn,vn,Ve,{docId:18,currentUser:19,storageAdapter:20,lockAdapter:21},null,[-1,-1,-1])}}function Dt(e){return`markup:doc:${e}`}function Lt(e){return`markup:versions:${e}`}function Ln(){return{storageAdapter:{async getDocument(n){const i=localStorage.getItem(Dt(n));if(!i)throw new Error("not_found");return JSON.parse(i)},async saveDocument(n,i,o){let r;try{r=await this.getDocument(n)}catch{}const l={...r??i,...i,image:i.image??(r==null?void 0:r.image),version:((r==null?void 0:r.version)??0)+1,updatedAt:Date.now()};return localStorage.setItem(Dt(n),JSON.stringify(l)),{version:l.version}},async listVersions(n){const i=localStorage.getItem(Lt(n));return i?JSON.parse(i):[]},async saveVersion(n,i){const o=await this.listVersions(n),r=`${n}-${Date.now()}`,l={...i,id:r};return localStorage.setItem(Lt(n),JSON.stringify([l,...o])),{versionId:r}}},lockAdapter:{async acquire(){return{ok:!0,expiresAt:Date.now()+6e4}},async renew(){return{ok:!0}},async release(){return{ok:!0}},async get(){return{locked:!1}}}}}function Un(e){let t,n,i,o,r,l;return r=new Dn({props:{docId:Pn,currentUser:e[2],storageAdapter:e[0],lockAdapter:e[1]}}),{c(){t=R("div"),n=R("header"),n.innerHTML="<strong>Markup Prototype</strong>",i=ie(),o=R("main"),jt(r.$$.fragment),g(n,"display","flex"),g(n,"align-items","center"),g(n,"gap","12px"),g(n,"padding","8px 12px"),g(n,"border-bottom","1px solid var(--color-border)"),g(n,"background","var(--color-surface)"),g(t,"height","100vh"),g(t,"display","grid"),g(t,"grid-template-rows","auto 1fr")},m(s,f){N(s,t,f),y(t,n),y(t,i),y(t,o),tt(r,o,null),l=!0},p:K,i(s){l||(ne(r.$$.fragment,s),l=!0)},o(s){se(r.$$.fragment,s),l=!1},d(s){s&&P(t),nt(r)}}}const Pn="prototype-doc";function On(e){const{storageAdapter:t,lockAdapter:n}=Ln();return[t,n,{id:"demo",name:"Demo"}]}class zn extends ot{constructor(t){super(),it(this,t,On,Un,Ve,{})}}new zn({target:document.getElementById("app")});
